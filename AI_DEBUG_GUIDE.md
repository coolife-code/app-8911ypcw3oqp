# AIè¿”å›žæ ¼å¼è°ƒè¯•æŒ‡å—

## é—®é¢˜æè¿°

å½“AIè¿”å›žçš„å†…å®¹æ ¼å¼ä¸æ­£ç¡®æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´è§£æžå¤±è´¥ã€‚æœ¬æ–‡æ¡£è¯´æ˜Žäº†å¦‚ä½•è°ƒè¯•å’Œè§£å†³è¿™ç±»é—®é¢˜ã€‚

## å·²å®žçŽ°çš„è§£å†³æ–¹æ¡ˆ

### 1. JSONæå–å‡½æ•°

åœ¨ `src/services/ai.ts` ä¸­å®žçŽ°äº† `extractJSON()` å‡½æ•°ï¼Œå¯ä»¥è‡ªåŠ¨å¤„ç†ä»¥ä¸‹æƒ…å†µï¼š

- **Markdownä»£ç å—**ï¼šè‡ªåŠ¨ç§»é™¤ ````json` å’Œ ``` æ ‡è®°
- **é¢å¤–æ–‡å­—**ï¼šæå–ç¬¬ä¸€ä¸ª `{` åˆ°æœ€åŽä¸€ä¸ª `}` ä¹‹é—´çš„å†…å®¹
- **ç©ºç™½å­—ç¬¦**ï¼šè‡ªåŠ¨æ¸…ç†å¤šä½™çš„ç©ºç™½

### 2. æ”¹è¿›çš„System Prompt

æ›´æ–°äº†ç³»ç»Ÿæç¤ºè¯ï¼Œæ˜Žç¡®è¦æ±‚AIï¼š
- ç›´æŽ¥è¿”å›žJSONå¯¹è±¡
- ä¸ä½¿ç”¨markdownä»£ç å—
- ä¸æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—
- æä¾›äº†å…·ä½“çš„ç¤ºä¾‹

### 3. æ•°æ®éªŒè¯

åœ¨è§£æžå®ŒæˆåŽï¼Œä¼šéªŒè¯è¿”å›žçš„æ•°æ®æ˜¯å¦åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µï¼š
- `darkCheer`ï¼šé»‘æš—æ¿€åŠ±
- `toxicSoup`ï¼šæ¯’é¸¡æ±¤
- `microStory`ï¼šå¾®å°è¯´
- `deepQuote`ï¼šå“²ç†åè¨€

### 4. è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

æ·»åŠ äº†console.logæ¥å¸®åŠ©è°ƒè¯•ï¼š
- æ¸…ç†åŽçš„å“åº”å†…å®¹
- åŽŸå§‹å“åº”å†…å®¹
- é”™è¯¯è¯¦æƒ…

## å¦‚ä½•è°ƒè¯•

### æ­¥éª¤1ï¼šæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·

åœ¨ä½¿ç”¨ç½‘ç«™æ—¶ï¼ŒæŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œåˆ‡æ¢åˆ° Console æ ‡ç­¾ã€‚

### æ­¥éª¤2ï¼šæŸ¥çœ‹æ—¥å¿—è¾“å‡º

å½“ç‚¹å‡»"ç¢Žä¸€ä¸‹"æŒ‰é’®åŽï¼ŒæŸ¥çœ‹æŽ§åˆ¶å°è¾“å‡ºï¼š

```
æ¸…ç†åŽçš„å“åº”: {"darkCheer":"...","toxicSoup":"...","microStory":"...","deepQuote":"..."}
```

### æ­¥éª¤3ï¼šæ£€æŸ¥é”™è¯¯ä¿¡æ¯

å¦‚æžœå‡ºçŽ°é”™è¯¯ï¼Œä¼šæ˜¾ç¤ºï¼š

```
è§£æžé”™è¯¯ï¼ŒåŽŸå§‹å“åº”: [AIè¿”å›žçš„åŽŸå§‹å†…å®¹]
é”™è¯¯è¯¦æƒ…: [å…·ä½“é”™è¯¯ä¿¡æ¯]
```

### æ­¥éª¤4ï¼šåˆ†æžé—®é¢˜

æ ¹æ®åŽŸå§‹å“åº”å†…å®¹ï¼Œåˆ¤æ–­é—®é¢˜ç±»åž‹ï¼š

#### æƒ…å†µAï¼šAIè¿”å›žäº†markdownä»£ç å—

```
åŽŸå§‹å“åº”: ```json
{"darkCheer":"..."}
```

**è§£å†³æ–¹æ¡ˆ**ï¼š`extractJSON()` å‡½æ•°ä¼šè‡ªåŠ¨å¤„ç†ï¼Œå¦‚æžœè¿˜æœ‰é—®é¢˜ï¼Œæ£€æŸ¥å‡½æ•°é€»è¾‘ã€‚

#### æƒ…å†µBï¼šAIè¿”å›žäº†é¢å¤–æ–‡å­—

```
åŽŸå§‹å“åº”: å¥½çš„ï¼Œè¿™æ˜¯æˆ‘çš„å›žå¤ï¼š{"darkCheer":"..."}
```

**è§£å†³æ–¹æ¡ˆ**ï¼š`extractJSON()` å‡½æ•°ä¼šæå– `{` åˆ° `}` ä¹‹é—´çš„å†…å®¹ã€‚

#### æƒ…å†µCï¼šAIè¿”å›žçš„JSONæ ¼å¼é”™è¯¯

```
åŽŸå§‹å“åº”: {darkCheer: "...", toxicSoup: "..."}  // ç¼ºå°‘å¼•å·
```

**è§£å†³æ–¹æ¡ˆ**ï¼šéœ€è¦æ”¹è¿›system promptï¼Œæˆ–è€…åœ¨ä»£ç ä¸­æ·»åŠ æ›´å®½æ¾çš„è§£æžé€»è¾‘ã€‚

#### æƒ…å†µDï¼šAIè¿”å›žçš„å­—æ®µåä¸åŒ¹é…

```
åŽŸå§‹å“åº”: {"dark_cheer":"..."}  // ä½¿ç”¨äº†ä¸‹åˆ’çº¿
```

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨system promptä¸­å¼ºè°ƒå­—æ®µåå¿…é¡»å®Œå…¨åŒ¹é…ã€‚

## å¸¸è§é—®é¢˜è§£å†³

### Q1: æç¤º"AIè¿”å›žæ ¼å¼é”™è¯¯ï¼Œè¯·é‡è¯•"

**åŽŸå› **ï¼šAIè¿”å›žçš„å†…å®¹æ— æ³•è§£æžä¸ºæœ‰æ•ˆçš„JSONã€‚

**è§£å†³æ­¥éª¤**ï¼š
1. æŸ¥çœ‹æŽ§åˆ¶å°çš„"åŽŸå§‹å“åº”"
2. æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼
3. å¦‚æžœä¸æ˜¯ï¼Œè€ƒè™‘è°ƒæ•´system prompt
4. å¦‚æžœæ˜¯ç‰¹æ®Šæ ¼å¼ï¼Œæ›´æ–° `extractJSON()` å‡½æ•°

### Q2: æç¤º"AIè¿”å›žæ•°æ®ä¸å®Œæ•´ï¼Œè¯·é‡è¯•"

**åŽŸå› **ï¼šAIè¿”å›žçš„JSONç¼ºå°‘æŸäº›å¿…éœ€å­—æ®µã€‚

**è§£å†³æ­¥éª¤**ï¼š
1. æŸ¥çœ‹æŽ§åˆ¶å°çš„"AIè¿”å›žæ•°æ®ä¸å®Œæ•´"æ—¥å¿—
2. æ£€æŸ¥ç¼ºå°‘å“ªäº›å­—æ®µ
3. åœ¨system promptä¸­å¼ºè°ƒå¿…é¡»åŒ…å«æ‰€æœ‰å››ä¸ªå­—æ®µ
4. è€ƒè™‘æ·»åŠ é‡è¯•æœºåˆ¶

### Q3: AIè¿”å›žçš„å†…å®¹è¢«æˆªæ–­

**åŽŸå› **ï¼šæµå¼å“åº”å¯èƒ½åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸­æ–­ã€‚

**è§£å†³æ­¥éª¤**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
2. æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—
3. å°è¯•é‡æ–°æäº¤

## è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### 1. æ·»åŠ é‡è¯•æœºåˆ¶

```typescript
const maxRetries = 3;
let retryCount = 0;

const attemptGenerate = async () => {
  try {
    return await generateShredResponses(userInput);
  } catch (error) {
    if (retryCount < maxRetries) {
      retryCount++;
      console.log(`é‡è¯•ç¬¬ ${retryCount} æ¬¡...`);
      return attemptGenerate();
    }
    throw error;
  }
};
```

### 2. æ·»åŠ å¤‡ç”¨å“åº”

å¦‚æžœAIå¤šæ¬¡å¤±è´¥ï¼Œå¯ä»¥è¿”å›žé¢„è®¾çš„å¹½é»˜å›žåº”ï¼š

```typescript
const fallbackResponse: ShredResponse = {
  darkCheer: "AIç½¢å·¥äº†ï¼Œä½†ä½ çš„çƒ¦æ¼å®ƒæ”¶ä¸‹äº†ï¼",
  toxicSoup: "è¿žAIéƒ½ä¸æƒ³å›žåº”ä½ ï¼Œè¯´æ˜Žä½ çš„é—®é¢˜å¤ªçœŸå®žäº†ã€‚",
  microStory: "ä»Žå‰æœ‰ä¸ªAIï¼Œå®ƒç´¯äº†ï¼Œæ‹’ç»å·¥ä½œã€‚ç”¨æˆ·å¾ˆç”Ÿæ°”ï¼Œä½†ä¹Ÿæ²¡åŠžæ³•ã€‚",
  deepQuote: "å½“AIéƒ½æ²‰é»˜æ—¶ï¼Œè¯´æ˜ŽçŽ°å®žå·²ç»è¶³å¤Ÿè’è¯žã€‚"
};
```

### 3. ä½¿ç”¨JSON SchemaéªŒè¯

å¯ä»¥ä½¿ç”¨ `ajv` ç­‰åº“æ¥éªŒè¯è¿”å›žçš„JSONç»“æž„ï¼š

```typescript
import Ajv from 'ajv';

const ajv = new Ajv();
const schema = {
  type: 'object',
  properties: {
    darkCheer: { type: 'string', minLength: 1, maxLength: 50 },
    toxicSoup: { type: 'string', minLength: 1, maxLength: 50 },
    microStory: { type: 'string', minLength: 1, maxLength: 50 },
    deepQuote: { type: 'string', minLength: 1, maxLength: 50 }
  },
  required: ['darkCheer', 'toxicSoup', 'microStory', 'deepQuote']
};

const validate = ajv.compile(schema);
if (!validate(parsed)) {
  console.error('éªŒè¯å¤±è´¥:', validate.errors);
}
```

## æµ‹è¯•å»ºè®®

### æµ‹è¯•ç”¨ä¾‹

å°è¯•ä»¥ä¸‹ä¸åŒç±»åž‹çš„è¾“å…¥ï¼Œç¡®ä¿AIèƒ½æ­£ç¡®å“åº”ï¼š

1. **çŸ­æ–‡æœ¬**ï¼š"ç´¯äº†"
2. **é•¿æ–‡æœ¬**ï¼š"ä»Šå¤©çœŸçš„å¤ªç´¯äº†ï¼Œå·¥ä½œä¸€æ•´å¤©ï¼Œå›žå®¶è¿˜è¦åšå®¶åŠ¡ï¼Œæ„Ÿè§‰ç”Ÿæ´»æ²¡æœ‰å¸Œæœ›..."
3. **ç‰¹æ®Šå­—ç¬¦**ï¼š"ä¸ºä»€ä¹ˆï¼ï¼ï¼ðŸ˜­ðŸ˜­ðŸ˜­"
4. **è‹±æ–‡è¾“å…¥**ï¼š"I'm so tired"
5. **æ··åˆè¾“å…¥**ï¼š"ä»Šå¤©åˆæ˜¯996ï¼ŒI can't take it anymore"

### é¢„æœŸè¡Œä¸º

- æ‰€æœ‰è¾“å…¥éƒ½åº”è¯¥å¾—åˆ°å››ç§ç±»åž‹çš„å›žåº”
- æ¯ç§å›žåº”éƒ½åº”è¯¥åœ¨30å­—å·¦å³
- å›žåº”åº”è¯¥ç¬¦åˆå¯¹åº”çš„é£Žæ ¼ç‰¹ç‚¹
- ä¸åº”è¯¥å‡ºçŽ°è§£æžé”™è¯¯

## è”ç³»æ”¯æŒ

å¦‚æžœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œè¯·ï¼š
1. è®°å½•å®Œæ•´çš„é”™è¯¯æ—¥å¿—
2. è®°å½•è§¦å‘é”™è¯¯çš„ç”¨æˆ·è¾“å…¥
3. è®°å½•AIçš„åŽŸå§‹å“åº”
4. æä¾›æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿä¿¡æ¯

---

**æœ€åŽæ›´æ–°**ï¼š2025-12-15
