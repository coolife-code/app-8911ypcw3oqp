# æ›´æ–°æ—¥å¿—

## [ä¿®å¤] AIè¿”å›æ ¼å¼é”™è¯¯é—®é¢˜ - 2025-12-15

### é—®é¢˜æè¿°
AIè¿”å›çš„å†…å®¹å¯èƒ½åŒ…å«markdownä»£ç å—æ ‡è®°æˆ–é¢å¤–æ–‡å­—ï¼Œå¯¼è‡´JSONè§£æå¤±è´¥ã€‚

### è§£å†³æ–¹æ¡ˆ

#### 1. æ–°å¢JSONæå–å‡½æ•° (`src/services/ai.ts`)

```typescript
const extractJSON = (text: string): string => {
  // ç§»é™¤å¯èƒ½çš„markdownä»£ç å—æ ‡è®°
  let cleaned = text.trim();
  
  // ç§»é™¤ ```json æˆ– ``` å¼€å¤´
  cleaned = cleaned.replace(/^```json\s*/i, '');
  cleaned = cleaned.replace(/^```\s*/, '');
  
  // ç§»é™¤ ``` ç»“å°¾
  cleaned = cleaned.replace(/\s*```\s*$/, '');
  
  // æŸ¥æ‰¾ç¬¬ä¸€ä¸ª { å’Œæœ€åä¸€ä¸ª }
  const firstBrace = cleaned.indexOf('{');
  const lastBrace = cleaned.lastIndexOf('}');
  
  if (firstBrace !== -1 && lastBrace !== -1 && lastBrace > firstBrace) {
    cleaned = cleaned.substring(firstBrace, lastBrace + 1);
  }
  
  return cleaned.trim();
};
```

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨ç§»é™¤markdownä»£ç å—æ ‡è®°ï¼ˆ```json å’Œ ```ï¼‰
- æå–ç¬¬ä¸€ä¸ª `{` åˆ°æœ€åä¸€ä¸ª `}` ä¹‹é—´çš„å†…å®¹
- æ¸…ç†å¤šä½™çš„ç©ºç™½å­—ç¬¦

#### 2. æ”¹è¿›System Prompt

**æ›´æ–°å‰**ï¼š
```
ä½ æ˜¯ç¢çº¸æœºé‡Œçš„æ¯’èˆŒå°ç²¾çµï¼Œè¯·æŠŠç”¨æˆ·è¾“å…¥å½“æˆç‡ƒæ–™ï¼Œä¸¥æ ¼æŒ‰ä»¥ä¸‹JSONæ ¼å¼è¿”å›...
```

**æ›´æ–°å**ï¼š
```
ä½ æ˜¯ç¢çº¸æœºé‡Œçš„æ¯’èˆŒå°ç²¾çµã€‚ç”¨æˆ·ä¼šè¾“å…¥ä»–ä»¬çš„å¿ƒæƒ…ã€åæ§½æˆ–ç¢ç¢å¿µï¼Œä½ éœ€è¦ç”Ÿæˆå››ç§ä¸åŒé£æ ¼çš„å›åº”ã€‚

ã€é‡è¦ã€‘ä½ çš„å›å¤å¿…é¡»æ˜¯çº¯JSONæ ¼å¼ï¼Œä¸è¦æ·»åŠ ä»»ä½•markdownæ ‡è®°ï¼ˆå¦‚```jsonï¼‰ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—ï¼Œåªè¿”å›JSONå¯¹è±¡ã€‚

JSONæ ¼å¼è¦æ±‚ï¼š
{
  "darkCheer": "è¶Šä¸§è¶Šç‡ƒçš„é»‘æš—æ¿€åŠ±è¯è¯­ï¼Œ30å­—ä»¥å†…",
  "toxicSoup": "ä¸€é’ˆè§è¡€çš„æ¯’é¸¡æ±¤ç°å®æ„Ÿæ‚Ÿï¼Œ30å­—ä»¥å†…",
  "microStory": "30å­—å¾®å°è¯´ï¼Œè¦æœ‰åè½¬",
  "deepQuote": "å‡è£…æ·±åˆ»çš„å“²ç†åè¨€ï¼Œ30å­—ä»¥å†…"
}

ç¤ºä¾‹ï¼š
ç”¨æˆ·è¾“å…¥ï¼šä»Šå¤©åˆåŠ ç­åˆ°å¾ˆæ™šï¼Œå¥½ç´¯
ä½ çš„å›å¤ï¼š
{"darkCheer":"ç´¯ï¼Ÿé‚£æ˜¯å› ä¸ºä½ è¿˜æœ‰è¢«å‰¥å‰Šçš„ä»·å€¼ï¼Œæ­å–œï¼","toxicSoup":"åŠ ç­ä¸ä¼šè®©ä½ å˜å¼ºï¼Œåªä¼šè®©è€æ¿çš„è½¦å˜è±ªã€‚","microStory":"ä»–åŠ ç­åˆ°æ·±å¤œã€‚ç¬¬äºŒå¤©ï¼Œè€æ¿å¤¸ä»–å‹¤å¥‹ã€‚ç¬¬ä¸‰å¤©ï¼Œä»–è¢«ä¼˜åŒ–äº†ã€‚","deepQuote":"å½“ä½ è§‰å¾—ç´¯çš„æ—¶å€™ï¼Œè¯´æ˜ä½ è¿˜åœ¨å‘ä¸Šçˆ¬ã€‚èººå¹³çš„äººä»ä¸å–Šç´¯ã€‚"}

è®°ä½ï¼šç›´æ¥è¿”å›JSONå¯¹è±¡ï¼Œä¸è¦ç”¨```åŒ…è£¹ï¼
```

**æ”¹è¿›ç‚¹**ï¼š
- æ˜ç¡®è¦æ±‚ä¸ä½¿ç”¨markdownä»£ç å—
- æä¾›å…·ä½“çš„ç¤ºä¾‹è¾“å…¥å’Œè¾“å‡º
- å¼ºè°ƒå¿…é¡»ç›´æ¥è¿”å›JSONå¯¹è±¡
- ä½¿ç”¨ã€é‡è¦ã€‘æ ‡è®°å…³é”®è¦æ±‚

#### 3. å¢å¼ºæ•°æ®éªŒè¯

```typescript
onComplete: () => {
  try {
    const cleanedResponse = extractJSON(fullResponse);
    console.log('æ¸…ç†åçš„å“åº”:', cleanedResponse);
    const parsed = JSON.parse(cleanedResponse);
    
    // éªŒè¯è¿”å›çš„æ•°æ®åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ
    if (!parsed.darkCheer || !parsed.toxicSoup || !parsed.microStory || !parsed.deepQuote) {
      console.warn('AIè¿”å›æ•°æ®ä¸å®Œæ•´:', parsed);
      reject(new Error('AIè¿”å›æ•°æ®ä¸å®Œæ•´ï¼Œè¯·é‡è¯•'));
      return;
    }
    
    resolve({
      darkCheer: parsed.darkCheer,
      toxicSoup: parsed.toxicSoup,
      microStory: parsed.microStory,
      deepQuote: parsed.deepQuote
    });
  } catch (error) {
    console.error('è§£æé”™è¯¯ï¼ŒåŸå§‹å“åº”:', fullResponse);
    console.error('é”™è¯¯è¯¦æƒ…:', error);
    reject(new Error(`AIè¿”å›æ ¼å¼é”™è¯¯ï¼Œè¯·é‡è¯•`));
  }
}
```

**æ”¹è¿›ç‚¹**ï¼š
- éªŒè¯æ‰€æœ‰å¿…éœ€å­—æ®µæ˜¯å¦å­˜åœ¨
- æ·»åŠ è¯¦ç»†çš„consoleæ—¥å¿—ç”¨äºè°ƒè¯•
- æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

#### 4. å‹å¥½çš„é”™è¯¯æç¤º (`src/pages/HomePage.tsx`)

```typescript
catch (error) {
  console.error('ç¢çº¸å¤±è´¥:', error);
  
  // æ ¹æ®é”™è¯¯ç±»å‹æä¾›ä¸åŒçš„æç¤º
  let errorMessage = 'è¯·ç¨åé‡è¯•';
  if (error instanceof Error) {
    if (error.message.includes('æ ¼å¼é”™è¯¯')) {
      errorMessage = 'AIå°ç²¾çµæ‰“çŒç¡äº†ï¼Œè¯·å†è¯•ä¸€æ¬¡ ğŸ˜´';
    } else if (error.message.includes('ä¸å®Œæ•´')) {
      errorMessage = 'AIå°ç²¾çµå·æ‡’äº†ï¼Œè¯·å†è¯•ä¸€æ¬¡ ğŸ˜…';
    } else if (error.message.includes('ç½‘ç»œ')) {
      errorMessage = 'ç½‘ç»œè¿æ¥ä¸ç¨³å®šï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯• ğŸ“¡';
    } else {
      errorMessage = error.message;
    }
  }
  
  toast({
    title: 'ç¢çº¸å¤±è´¥ ğŸ’”',
    description: errorMessage,
    variant: 'destructive'
  });
}
```

**æ”¹è¿›ç‚¹**ï¼š
- æ ¹æ®é”™è¯¯ç±»å‹æä¾›ä¸åŒçš„å‹å¥½æç¤º
- ä½¿ç”¨emojiå¢åŠ è¶£å‘³æ€§
- ä¿æŒåƒç´ é£æ ¼çš„å¹½é»˜æ„Ÿ

### æµ‹è¯•å»ºè®®

1. **æ­£å¸¸æƒ…å†µ**ï¼šè¾“å…¥"ä»Šå¤©å¥½ç´¯"ï¼Œåº”è¯¥æ­£å¸¸è¿”å›å››ç§å›åº”
2. **ç‰¹æ®Šå­—ç¬¦**ï¼šè¾“å…¥"ä¸ºä»€ä¹ˆï¼ï¼ï¼ğŸ˜­"ï¼Œåº”è¯¥æ­£å¸¸å¤„ç†
3. **é•¿æ–‡æœ¬**ï¼šè¾“å…¥è¶…è¿‡100å­—çš„å†…å®¹ï¼Œåº”è¯¥æ­£å¸¸å¤„ç†
4. **ç½‘ç»œé—®é¢˜**ï¼šæ–­ç½‘æƒ…å†µä¸‹ï¼Œåº”è¯¥æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º

### è°ƒè¯•æ–¹æ³•

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹Consoleæ ‡ç­¾ï¼š

1. **æˆåŠŸæƒ…å†µ**ï¼š
   ```
   æ¸…ç†åçš„å“åº”: {"darkCheer":"...","toxicSoup":"...","microStory":"...","deepQuote":"..."}
   ```

2. **æ ¼å¼é”™è¯¯**ï¼š
   ```
   è§£æé”™è¯¯ï¼ŒåŸå§‹å“åº”: [AIè¿”å›çš„å†…å®¹]
   é”™è¯¯è¯¦æƒ…: [é”™è¯¯ä¿¡æ¯]
   ```

3. **æ•°æ®ä¸å®Œæ•´**ï¼š
   ```
   AIè¿”å›æ•°æ®ä¸å®Œæ•´: {darkCheer: "...", toxicSoup: "..."}
   ```

### ç›¸å…³æ–‡æ¡£

- è¯¦ç»†è°ƒè¯•æŒ‡å—ï¼š`AI_DEBUG_GUIDE.md`
- APIæœåŠ¡ä»£ç ï¼š`src/services/ai.ts`
- ä¸»é¡µé¢ä»£ç ï¼š`src/pages/HomePage.tsx`

### å½±å“èŒƒå›´

- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… å‘åå…¼å®¹
- âœ… æé«˜äº†ç³»ç»Ÿç¨³å®šæ€§
- âœ… æ”¹å–„äº†ç”¨æˆ·ä½“éªŒ

### åç»­ä¼˜åŒ–å»ºè®®

1. **æ·»åŠ é‡è¯•æœºåˆ¶**ï¼šè‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚ï¼ˆæœ€å¤š3æ¬¡ï¼‰
2. **æ·»åŠ å¤‡ç”¨å“åº”**ï¼šå½“AIå¤šæ¬¡å¤±è´¥æ—¶ï¼Œè¿”å›é¢„è®¾çš„å¹½é»˜å›åº”
3. **æ·»åŠ åŠ è½½è¿›åº¦**ï¼šæ˜¾ç¤ºAIç”Ÿæˆçš„è¿›åº¦ï¼ˆå·²ç”Ÿæˆå‡ ä¸ªå›åº”ï¼‰
4. **æ·»åŠ ç¼“å­˜æœºåˆ¶**ï¼šç¼“å­˜ç›¸åŒè¾“å…¥çš„ç»“æœï¼Œå‡å°‘APIè°ƒç”¨

---

## [åˆå§‹ç‰ˆæœ¬] ç¢å¿µå°æ ˆ - 2025-12-15

### åŠŸèƒ½ç‰¹æ€§

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… ç”¨æˆ·è¾“å…¥å¿ƒæƒ…å¡ç‰‡
- âœ… AIç”Ÿæˆå››ç§é£æ ¼å›åº”ï¼ˆé»‘æš—æ¿€åŠ±ã€æ¯’é¸¡æ±¤ã€å¾®å°è¯´ã€å“²ç†åè¨€ï¼‰
- âœ… ç¢çº¸æœºåŠ¨ç”»æ•ˆæœ
- âœ… å¡ç‰‡ç¿»é¢äº¤äº’
- âœ… æ‰‘å…‹ç‰Œå¼å æ”¾
- âœ… è¿ç»­ç¢çº¸åŠŸèƒ½

#### ç‰¹æ®ŠåŠŸèƒ½
- âœ… èƒŒæ™¯åƒç´ çŒ«åŠ¨ç”»
- âœ… ç¬¬7å¼ æ—¶å¡”ä½“æ™ƒåŠ¨æé†’
- âœ… åˆå¤œæ¨¡å¼ï¼ˆ0:00-6:00è‡ªåŠ¨åˆ‡æ¢ï¼‰
- âœ… æ˜Ÿæ˜Ÿé—ªçƒç‰¹æ•ˆ

#### è®¾è®¡é£æ ¼
- âœ… 8-bitåƒç´ æ¸¸æˆé£æ ¼
- âœ… Press Start 2Påƒç´ å­—ä½“
- âœ… ç™½å¤©/åˆå¤œåŒé…è‰²æ–¹æ¡ˆ
- âœ… ç²—çº¿æ¡è¾¹æ¡†å’Œæ˜æ˜¾åœ†è§’
- âœ… é¢—ç²’æ„Ÿè§†è§‰æ•ˆæœ

#### æŠ€æœ¯å®ç°
- âœ… React 18 + TypeScript + Vite
- âœ… shadcn/ui + Tailwind CSS
- âœ… é˜¿é‡Œäº‘ç™¾ç‚¼AI APIé›†æˆ
- âœ… æµå¼å“åº”å¤„ç†
- âœ… å“åº”å¼è®¾è®¡

### ç»„ä»¶ç»“æ„

```
src/components/shred/
â”œâ”€â”€ InputCard.tsx      # è¾“å…¥å¡ç‰‡
â”œâ”€â”€ ShredMachine.tsx   # ç¢çº¸æœºåŠ¨ç”»
â”œâ”€â”€ PaperStrip.tsx     # çº¸æ¡å¡ç‰‡
â”œâ”€â”€ CardStack.tsx      # å¡ç‰‡å †å 
â””â”€â”€ PixelCat.tsx       # åƒç´ çŒ«åŠ¨ç”»
```

### é¡µé¢ç»“æ„

```
src/pages/
â””â”€â”€ HomePage.tsx       # ä¸»é¡µé¢
```

### æœåŠ¡æ¥å£

```
src/services/
â””â”€â”€ ai.ts             # AIæœåŠ¡æ¥å£
```

---

**ç»´æŠ¤è€…**ï¼šç¢å¿µå°æ ˆå¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**ï¼š2025-12-15
